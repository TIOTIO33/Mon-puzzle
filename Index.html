<!DOCTYPE html><html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Puzzle Drag & Drop</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #f4f4f4;
            height: 100vh;
        }
        #puzzle-board {
            display: grid;
            gap: 2px;
            background: #ccc;
        }
        .slot {
            background: white;
            border: 1px dashed #999;
            width: 80px;
            height: 80px;
        }
        #pieces-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 10px;
            background: #333;
            gap: 5px;
        }
        .piece {
            width: 80px;
            height: 80px;
            cursor: grab;
            border: 2px solid #fff;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h2>Mon Puzzle</h2>
    <input type="file" id="imageInput" accept="image/*">
    <div id="puzzle-board"></div>
    <div id="pieces-bar"></div><script>
let gridSize = 3;
let img = new Image();
let pieces = [];

const board = document.getElementById('puzzle-board');
const bar = document.getElementById('pieces-bar');
const imageInput = document.getElementById('imageInput');

imageInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(evt) {
            img.onload = () => generatePuzzle();
            img.src = evt.target.result;
        };
        reader.readAsDataURL(file);
    }
});

function generatePuzzle() {
    board.innerHTML = '';
    bar.innerHTML = '';
    pieces = [];

    board.style.gridTemplateColumns = `repeat(${gridSize}, 80px)`;
    board.style.gridTemplateRows = `repeat(${gridSize}, 80px)`;

    let count = 0;
    for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
            let slot = document.createElement('div');
            slot.classList.add('slot');
            slot.dataset.index = count;
            slot.ondragover = e => e.preventDefault();
            slot.ondrop = dropPiece;
            board.appendChild(slot);
            count++;
        }
    }

    for (let i = 0; i < gridSize * gridSize; i++) {
        let canvas = document.createElement('canvas');
        canvas.width = 80;
        canvas.height = 80;
        let ctx = canvas.getContext('2d');

        let sx = (i % gridSize) * (img.width / gridSize);
        let sy = Math.floor(i / gridSize) * (img.height / gridSize);

        ctx.drawImage(img, sx, sy, img.width / gridSize, img.height / gridSize, 0, 0, 80, 80);
        canvas.classList.add('piece');
        canvas.draggable = true;
        canvas.dataset.index = i;
        canvas.ondragstart = e => {
            e.dataTransfer.setData('text/plain', i);
        };

        bar.appendChild(canvas);
        pieces.push(canvas);
    }

    shuffleBar();
}

function shuffleBar() {
    for (let i = bar.children.length; i >= 0; i--) {
        bar.appendChild(bar.children[Math.random() * i | 0]);
    }
}

function dropPiece(e) {
    let index = e.dataTransfer.getData('text/plain');
    if (parseInt(this.dataset.index) === parseInt(index)) {
        let piece = [...bar.children].find(p => p.dataset.index === index);
        this.innerHTML = '';
        this.appendChild(piece);
        piece.draggable = false;
        piece.style.cursor = 'default';
    } else {
        alert('Mauvais emplacement, essaie encore !');
    }
}
</script></body>
</html>
